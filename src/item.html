<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReSpark - Item Lifecycle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body class="pb-32 md:pb-8">
    <div class="aurora-bg"></div>
    <div id="loading-state" class="text-center p-10">Loading item...</div>

    <div id="content-state" class="container mx-auto px-4 py-6 hidden">
        <a href="index.html" class="text-sky-600 hover:text-sky-800 flex items-center mb-4">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            Back to Dashboard
        </a>
        <div class="flex items-center">
            <div id="item-icon-bg" class="w-16 h-16 rounded-full flex items-center justify-center mr-4 text-4xl"></div>
            <div>
                <h1 id="item-name-title" class="text-3xl font-bold text-slate-800"></h1>
                <p id="item-status-text" class="text-lg"></p>
            </div>
        </div>

        <div class="glass-card p-6 my-8 text-center fade-in-subtle">
            <p class="text-slate-500 mb-2">This item's second life has earned:</p>
            <div class="flex items-center justify-center">
                <span id="spark-points-counter" class="text-6xl font-bold text-emerald-500">0</span>
                <span class="text-xl font-semibold text-emerald-500 ml-2">Spark Points</span>
            </div>
        </div>

        <div class="mb-8">
            <h2 class="text-xl font-semibold mb-3 text-slate-700">Choose an action:</h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <button id="repair-btn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105 text-left flex items-center"><span class="text-2xl mr-3">üõ†Ô∏è</span><div>Repair<br><span class="font-normal text-sm">+500 Points</span></div></button>
                <button id="reuse-btn" class="bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105 text-left flex items-center"><span class="text-2xl mr-3">‚ôªÔ∏è</span><div>Reuse<br><span class="font-normal text-sm">+250 Points</span></div></button>
                <button id="recycle-btn" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105 text-left flex items-center"><span class="text-2xl mr-3">üóëÔ∏è</span><div>Recycle<br><span class="font-normal text-sm">+20 Points</span></div></button>
            </div>
        </div>

        <div>
            <h2 class="text-xl font-semibold mb-2 text-slate-700">Repair-First Map</h2>
            <div id="map" class="h-80 w-full rounded-xl shadow-lg border border-white"></div>
        </div>
    </div>
    
    <nav class="bottom-nav flex justify-around">
        <a href="index.html" class="nav-link active flex-grow flex flex-col items-center justify-center p-2 transition-transform">
            <div class="nav-icon-bg h-8 w-12 rounded-full flex items-center justify-center transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V6z"></path></svg>
            </div>
            <span class="text-xs mt-1">Dashboard</span>
        </a>
        <a href="profile.html" class="nav-link flex-grow flex flex-col items-center justify-center p-2 text-slate-500 transition-transform">
            <div class="nav-icon-bg h-8 w-12 rounded-full flex items-center justify-center transition-all">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            </div>
            <span class="text-xs mt-1">Profile</span>
        </a>
    </nav>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="./js/main.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const itemId = getUrlParameter('id');
        const item = getItemById(itemId);

        if (!item) {
            document.getElementById('loading-state').textContent = 'Item not found.';
            return;
        }

        const itemData = ARKAVS_ELECTRONICS[item.itemKey];
        const conditionData = ARKAVS_CONDITIONS[item.conditionKey];
        
        document.getElementById('item-name-title').textContent = itemData.name;
        document.getElementById('item-status-text').textContent = conditionData.text;
        
        const iconBg = document.getElementById('item-icon-bg');
        iconBg.textContent = itemData.emoji;
        let colorClass = 'bg-green-100 text-green-600';
        let statusColorClass = 'text-green-600';
        if (conditionData.severity === 'orange') {
            colorClass = 'bg-orange-100 text-orange-600';
            statusColorClass = 'text-orange-600';
        }
        if (conditionData.severity === 'red') {
            colorClass = 'bg-red-100 text-red-600';
            statusColorClass = 'text-red-600';
        }
        iconBg.classList.add(...colorClass.split(' '));
        document.getElementById('item-status-text').classList.add(statusColorClass);

        document.getElementById('loading-state').classList.add('hidden');
        document.getElementById('content-state').classList.remove('hidden');

        let sessionPoints = 0;
        const timerInterval = setInterval(() => {
            sessionPoints = Math.floor((Date.now() - item.createdAt) / 10000);
            document.getElementById('spark-points-counter').textContent = sessionPoints;
        }, 1000);

        function handleAction(action, basePoints) {
            clearInterval(timerInterval);
            completeItemAction(itemId, action, basePoints, sessionPoints);
            window.location.href = 'profile.html';
        }
        document.getElementById('repair-btn').addEventListener('click', () => handleAction('repair', 500));
        document.getElementById('reuse-btn').addEventListener('click', () => handleAction('reuse', 250));
        document.getElementById('recycle-btn').addEventListener('click', () => handleAction('recycle', 20));

        const map = L.map('map').setView([8.5241, 76.9366], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        
        const centerLat = 8.5241;
        const centerLng = 76.9366;
        for (let i = 0; i < 30; i++) {
            const lat = centerLat + (Math.random() - 0.5) * 0.15;
            const lng = centerLng + (Math.random() - 0.5) * 0.15;
            L.marker([lat, lng]).addTo(map).bindPopup(`Repair Shop #${i + 1}`);
        }
    });
    </script>
</body>
</html>
